# Архитектура компьютеров и операционные системы

## Лекция 1

Введение. Цели и задачи курса. Критерии оценивания.

## Лекция 2

Представление целых чисел. Биты, байты, октеты, нумерация битов в байте, нумерация байтов в слове. Порядок байт в слове.
Битовые операции в Си.

Представление знаковых чисел.

Целочисленные типы в Си.

Переполнения беззнаковых и знаковых значений в Си.

Понятие undefined behavior. Влияние undefined behavior на компиляцию и исполнение программы.

## Лекция 3

Числа с фиксированной точкой. Выполнение операций с фиксированной точкой. Округление.

Представление чисел с плавающей точкой. Операции с числами с плавающей точкой. Накопление ошибки.

## Лекция 4

Реализации языка Си: freestanding и hosted. Взаимодействие программы на Си с окружением.

Строки в Си.

Кодировки текста. Работа с локалью в Си.

## Лекция 5

Управление памятью. Способы выделения памяти под строки. Ошибка переполнения буфера.

Выравнивание значений в памяти. Базовые типи Си, их размеры и требования к выравниванию. Дополнение (padding)
в структурах.

Динамическая память. Реализация оптимизации небольших строк. Реализация вектора.

## Лекция 6

Проект GNU, его история и цели.

GNU Toolchain: GCC, GNU Binutils.

Стадии компиляции программы на Си. Типы получаемых бинарных файлов.

## Лекция 7

Физические основы вычислительной техники. Основы электродинамики.

Аккумуляторы.

Физические основы работы транзисторов. Рассеиваемая мощность.

## Лекция 8

Понятие шины. Типы шин. Диаграммы работы шины.

Исторический обзор развития микропроцессоров.

RISC-процессоры. Исторический обзор развития.

## Лекция 9

Устройство и функционирование оперативной памяти. Временные характеристики работы DRAM.

Кеширование. Характеристики кеш-памяти.

## Лекция 10

Принципы фон-Неймана.

Язык ассемблера. Основные характеристики. Области применения. Цели изучения.

## Лекция 11

Вид программы на ассемблере. Секционирование программы. Определение данных.

Архитектура x86 (i686). Регистры процессора. Простейшие методы адресации.
Инструкции пересылки. Арифметические инструкции.

## Лекция 12

Виды сдвигов. Преобразования данных. Условные переходы.
Работа с ОЗУ.

## Лекция 13

Стек программы. Методы адресации при обращении к памяти.
Соглашения о вызовах в x86. Организация стековых фреймов.
Локальные переменные.

## Лекция 14

Реализация длинной арифметики с использованием флага переноса (CF).

Отображение основных конструкций программ на языке Си в программы на ассемблере.

Инструкции SSE2 для работы с плавающей точкой. Понятие векторных инструкций.

## Лекция 15

Кодирование инструкций в памяти. Загрузка программы на выполнение.
Неперемещаемый и позиционно-независимый код.

## Лекция 16

Исполняемые файлы. Формат ELF исполняемых файлов. Секции в исполняемых файлах.

Реализация позиционно-независимого кода с помощью настройки секций GOT и GOT.PLT.

Позднее связывание при загрузке динамических библиотек в память.

## Лекция 17

Изоляция процессов. Пользовательский и привилегированный режим работы. Ядро операционной системы.
Системный вызов.

Виртуальная адресация памяти. Таблица страниц. TLB.

Распределение виртуального адресного пространства между ядром и процессом. Page Fault.

## Лекция 18

Производительность центрального процессора.

Конвейеризация. Предсказание переходов. Суперскалярность. Спекулятивные вычисления. Переименования регистров.

Ошибка Meltdown.

## Лекция 19

Взаимодействие со внешними устройствами. Регистры внешних устройств. Отображение в память внешних устройств.
Прерывания. Прямой доступ к памяти (DMA).

Защищенный режим работы процессора x86. Операционная система. Ядро ОС. Компоненты ядра. Структура ядра Linux.

## Лекция 20

Работа с файлами. Файловый дескриптор. Системные вызовы open, close, fsync, read, write, lseek, truncate, ftruncate.

Модель разграничения доступа. Идентификация субъектов доступа в POSIX. Пользователи, группы.

Аутентификация в POSIX. Авторизация в POSIX. Атрибуты файла. Избирательное управление доступом. Права доступа в POSIX.

## Лекция 21

Модель файловой системы. Блок-ориентированные устройства. Индексные дескрипторы, блоки данных.
Структура каталогов файловой системы. Символические и жесткие связи.

Системные вызовы stat, lstat, fstat.

Отсчет астрономического времени в POSIX-системах. Тип time_t. Функции time, mktime, localtime, gmtime.

## Лекция 22

Получение содержимого каталога. opendir, readdir, closedir, telldir, seekdir.

Монтирование. Файловые системы /proc и /sys. FUSE (filesystem in userspace).

Адресное пространство процесса.

## Лекция 23

Управление адресным пространством. Системные вызовы sbrk, mmap, munmap.

Demang Paging. Страничная подкачка. Copy-on-write. Необеспеченная память.

Оптимизация потребления физической памяти с помощью разделяемых библиотек.

## Лекция 24

Процессы. Атрибуты процессов. Системные вызовы получения информации о процессах.

Создание процесса - fork.

Завершение процесса - exit. Код завершения процесса.

Ожидание завершения процесса. Системные вызовы семейства wait.

## Лекция 25

Жизненный цикл процесса. Состояние процесса.

Замещение тела процесса с помощью функций семейства exec.

Схема fork/exec. Подготовка аргументов командной строки.

Понятие атомарности. Атомарность при работе с файлами.

## Лекция 26

Перенаправление стандартных потоков на работу с файлами.

Неименованный канал. Системный вызов pipe. Работа системных вызовов read и write
с каналом.

Реализация конвейеров с помощью каналов. Синхронизация процессов с помощью каналов.

Связь файлового дескриптора и высокоуровневого дескриптора потока (FILE *).
Буферизация высокоуровневых потоков.

## Лекция 27

Сигналы. Виды сигналов в POSIX-системах. Посылка сигнала процессу. Системный вызов kill.
Доставка сигнала. Сигналы, ожидающие доставки. Простейшая обработка сигналов.
Особенности обработки в разных операционных системах. Асинхронно-безопасные функции.

## Лекция 28

Установка флагов в обработчике сигнала. Ключевое слово volatile, тип sig_atomic_t.

Блокирование сигналов. Системный вызов sigprocmask.

Ожидание сигналов. sigsuspend.

Отображение сигналов на файловые дескрипторы signalfd (Linux-specific).

## Лекция 29

Основы организации TCP/IP сетей. Понятие IP-адреса, номера порта.

Интерфейс сокетов. Системные вызовы socket, bind, listen, accept.

Именованные каналы (FIFO).

## Лекция 30

Таймеры, работа с таймерами в POSIX.
Файловые дескрипторы таймеров (Linux-specific).

Варианты архитектуры сервера: процессы-обработчики, нити-обработчики, мультиплексирование ввода-вывода.

Неблокирующий ввод-вывод. 

Системный вызов epoll.

Событийно-ориентированные программы.

## Лекция 31

Последовательный интерфейс. Терминал. Работа с последовательным интерфейсом и терминалом в POSIX.

## Лекции 32-33

Нити. Типы нитей.

Реализация нитей в различных окружениях (POSIX, C11, C++11).

Создание нити в pthread (pthread_create), завершение нити, ожидание завершения нити.

Управление атрибутами нити.

Взамодействие нитей с системным вызовом fork().

Нити и сигналы.

Принудительное завершение нити.

Thread-local storage.

## Лекция 34

Разделяемые ресурсы. Критическая секция. Ошибка гонок (race condition).

Семафоры. Мьютексы. Реализация мьютексов в pthread.

Мониторы. Реализация мониторов с помощью мьютекса.

## Лекция 35

Ожидание события и оповещение о наступлении событий - condition variable.

Реализация в pthread.

Классические задачи синхронизации: барьер, обедающие философы, читатели-писатели,
производители-потребители, спящий парикмахер.

Тупики (deadlock). Обнаружение и избежание тупиков.

## Лекция 36

Модель памяти в Си программах. Сильная и слабая модель.

Атомарность работы с памятью. Data race.

Атомарные типы данных в Си и Си++.

Семантика доступа к атомарным данным (memory order).

## Лекция 37

Поддержка нитей в стандартной библиотеке Си++.

std::thread, std::mutex, std::condition_variable.

RAII для работы с мьютексами и condition variable.

Взаимодействие нитей: std::promise/std::future, std::packaged_task.

Асинхронность: std::async.

## Лекция 38

Планирование процессов ядром ОС (на примере Linux).

Пакетный планировщик, планировщик разделения времени, планировщик реального времени.

Алгоритм CFS работы планировщика разделения времени в ядре Linux.

Планирование реального времени FIFO и round-robin.
Проблема инверсии приоритета.

## Лекция 39

Типы ссылок в языке Си++.

Ссылки в шаблонных классах и функциях.

Шаблонные функции и классы с переменным числом аргументов.

## Лекция 40

Таблица открытых файловых дескрипторов процесса.
Структура, хранящая информацию об открытом файле (struct file).
Структура индексного дескриптора в памяти (struct vnode).

Добровольная и обязательная блокировка файла.

Квотирование ресурсов файловой системы.

Организация хранения данных в файловой системе RT-11.

Организация хранения данных в файловой системе FAT.

Организация хранения данных в файловой системе S5FS и ее наследниках.




