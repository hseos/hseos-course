# Анонимные функции в C++ 11

В языке JavaScript можно писать такие конструкции:

```javascript
function main() {

  var name = "World";                // Это -- локальная переменная для main()

  setTimeout(
    function() {                     // Эти три строки являются первым
      console.log("Hello, " + name); // аргументом функции
    },                               // setTimeout

    5000                             // А это -- второй аргумент setTimeout
  );

}
```

Первым аргументом `setTimeout` является **функция**, которая вызывается через
`5000` миллисекунд после вызова `setTimeout`.

Функцию можно передать как по имени, так и описать прямо в том месте, где
она синтаксически требуется. Такие функции называются *анонимными функциями*,
поскольку они не имеют имени, и могут использованы только там, где они объявлены.

Анонимная функция может объявлять свои локальные переменные, и кроме того,
может использовать переменные из той области видимости, которые доступны в
контексте ее описания. Такая методика называется *замыканием области видимости*.

## C++ 2011

В языке C++, начиная со стандарта 2011 года, появилась возможность объявления
анонимных функций.

Формальный синтаксис анонимной функции:
```
"[" [СПИСОК_ЗАХВАТА] "]" "(" [АРГУМЕНТЫ] ")" "{" ТЕЛО_ФУНКЦИИ "}"
```

Пример использования:
```cpp
#include <iostream>
#include <thread>

int main()
{
  std::thread(
    [ /* ничего не захватываем */ ] (/* нет аргументов */) {
      std::cout << "Hello, World!" << std::endl;
    }
  ).join();
  return 0;
}
```

В данном примере, вывод на экран производится из отдельной нити.

## Замыкания в анонимных функциях C++ 2011

По умолчанию, анонимные функции в C++ не имеют доступа к переменным вне
области своей видимости.

Передавать переменные можно с квадратных скобках. Переменные передаются
**по значению**, за исключением случая, когда перед именем переменной
присутствует символ `&`, - это признак передачи по ссылке.

```cpp
#include <cstdint>
#include <chrono>
#include <iostream>
#include <thread>
#include <random>

int main()
{
  std::string name;
  std::cin >> name;
  double rand_value;
  std::thread(
    [ name, &rand_value ] (/* нет аргументов */) {
      std::cout << "Hello, " << name << std::endl;

      uint32_t seed = std::chrono::system_clock::now().time_since_epoch().count();
      std::uniform_real_distribution<double> distribution(0.0, 1.0);
      std::default_random_engine generator(seed);
      rand_value = distribution(generator);
    }
  ).join();
  std::cout << "Random number in R[0,1] is: " << rand_value << std::endl;
  return 0;
}
```

Можно передавать **все** переменные по значению: `[=]` или **все** переменные
по ссылке: `[&]`. В таком случае, код не пройдет code review, и Вы потеряете
на этом драгоценные баллы в ejudge. Подумайте, почему.
