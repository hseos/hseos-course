## Цель семинара
  * Научиться выполнять практические задания в окружении ОС Linux

## Образ виртуальной машины
Для того, чтобы научиться работать в окружении любой операционной системы, не 
обязательно устанавливать ее на свой компьютер. Можно воспользоваться 
*виртуальной машиной*.

В данном курсе можно использовать [подготовленный образ](https://goo.gl/G10hmh) системы
Debian Linux для виртуальной машины [VirtualBox](https://www.virtualbox.org/).

### Параметры подготовленного образа
 * Операционная система: **Debian GNU/Linux 8 (32 bit)**
 * Предустановленные пакеты: **только для двух первых семинаров**
 * Имя обычного пользователя: **student**
 * Пароль обычного пользователя: **qwerty**
 * Пароль пользователя root: **qwerty**
 * Статический IP-адрес внутренней сети: **192.168.56.105**
 * Запущенные сервисы: **vsftpd sshd httpd**

### Создание виртуальной машины

Предполагается, что образ системы уже скачан и распакован.

`Machine`->`New...`. После этого указать параметры `Type: Linux`, `Version: Debian (32-bit)`. 
Памяти нам достаточно 512Мбайт. Не создавать виртуальный диск, а использовать существующий, 
затем выбрать файл образа.

Используется PAE-ядро с поддержкой SMP, поэтому необходимо отметить флаги в `System`->`Motherboard` и `System`->`Processor`: 

 * `Enable I/O APIC`
 * `Enable PAE/NX`


### Настройка внутренней сети
 Для доступа к виртуальной машине необходимо настроить дополнительный сетевой адаптер, связанный с внутренней сетью VirtualBox:
 `File`->`Preferences...`->`Network`->`Host-only networks`->`Значок "Добавить"`
 
 После этого нужно ввести параметры (или проверить параметры по умолчанию):
 
 ```
 IPv4 Address: 192.168.56.1
 IPv4 Network Mask: 255.255.255.0
 ```
 
 DHCP-сервер **не** нужен.
 
 После этого - включить виртуальный сетевой адаптер, если он не включен, а в настройках
 созданной виртуальной машины `Network`->`Adapter 2`:
   * Отметить `Enable Network Adapter`
   * Attached to: `Host-only Adapter`
   * Advanced -> Отметить `Cable Connected`
 
 В случае правильной настройки сети, по адресу [http://192.168.56.105](http://192.168.56.105) 
должна загрузиться страница "Apache2 Debian Default Page".

## Используемая в UNIX-подобных системах терминология
 * Файловая система представляет собой иерархию файлов и *каталогов*. Не
 нужно называть каталоги "папками".
 * В отличии от Windows, все файлы в UNIX являются равнозначными, независимо
 от их имени. Понятия "расширение файла" не существует, но для удобства
 восприятия имени файла пользователем, их снабжают *суффиксами имени*,
 отделяемые от основного имени точкой. Суффиксов у имени файла может быть
 несколько, например `.tar.gz`.
 * В системе выполняется огромное количество *процессов*, а не "задач".
 Процессы могут быть запущены как непосредственно пользователем, так и
 одним из *демонов*, которые запускаются при загрузке системы, и сами по
 себе являются процессами.

## Принятые обозначения клавиатурных сочетаний
 При работе с консольными UNIX-программами обычно используются следующие, исторически
 сложившиеся, обозначения клавиатурных сочетаний:
 * `C-Буква` - одновременное нажатие `Ctrl` и буквенной клавиши. Вниманию пользователей
 MacOS! `Ctrl` - это именно клавиша `Ctrl`, а не `Command`.
 * `M-Буква` - одноваременное нажатие `Alt` и буквенной клавиши. Сокращение "M" - от слова
 "Meta". Такая клавиша была на старых рабочих станциях Sun и SGI.
 * `C-Буква1 Буква2` - сначала одновременное нажатие `Ctrl` и `Буква1`, затем отпустить клавишу 
 `Ctrl` и нажать `Буква2`. Аналогично для клавиши `Alt`. Сочетание `C-Буква1` называется *префиксом*
 клавиатурного сочетания, обычно под одинаковыми префиксами группируются клавиатурные сочетания для
 действий одного характера
 * `C-Буква1 C-Буква2`. Нажать `Ctrl`, затем нажать и отпустить `Буква1`, нажать и отпустить `Буква2`. 
 После этого можно отпустить клавишу `Ctrl`.
 * Клавиши `F13`...`F15`. На PC-клавиатуре их нет. Их нажатие обеспечивается клавишей `Shift` и одной 
 функциональных клавиш с номером `F...` меньше, в зависимости от терминала, на 10 или на 12. Например,
 во многих графических терминалах, `Shift+F5` означает нажатие клавиши `F15`.

## Вход в систему

Linux, как и любые другие операционные системы семейства UNIX, является
**многопользовательской** операционной системой. Для начала работы необходимо
знать свое имя ползователя и пароль.

В зависимости от целей использования, вход в систему может быть осуществлен
различными способами.


### Локальный вход с графическим интерфейсом
Этот вариант обычно используется при установке Linux в качестве Desktop'а.
Как правило, в большинстве дистрибутивов Linux предусмотрен автоматический
вход в систему, если при установке был указан только один пользователь-человек
(существует еще и другой вид пользователей -- системные). Если пользователей несколько,
то вход в систему мало чем отличается от такового в ОС Windows или Mac.

После входа в систему, отображается графическая оболочка (GNOME, Unity или KDE).
Командная строка, с которой мы преимущественно будем работать, доступна с
помощью приложения "Терминал".

### Локальный вход без графического интерфейса
Этот вариант обычно используется при начальной настройке серверов (графический
стек является потенциальной "дырой" в безопасности, и обычно не устанавливается),
а также при работе со встраиваемыми системами.

После загрузки системы или подкдючения терминала отображается текстовое
приглашение с предложением ввести имя пользователя и пароль, а после входа
в систему, управление передается **командному интерпретатору**.

### Удаленный вход через SSH
Для подключения по SSH необходимо использовать команду (для Linux/Mac)

```
ssh ИМЯ_ПОЛЬЗОВАТЕЛЯ@ИМЯ_ХОСТА
```

Для подключения по SSH из Windows существуют специальные программы, например
[PuTTY](http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html).

После подключения нужно ввести пароль для входа в систему. В некоторых случаях
вводить пароль не потребуется, например, если настроена авторизация с
использованием SSH-ключей.

После входа в систему, управление передается командному интерпретатору.

**При использовании предоставляемого образа ВМ** подключение по SSH осуществляется
командой:

```
ssh student@192.168.56.105
```

## Основы работы с командной строкой
### Навигация по файловой системе

Приглашение командной строки обычно имеет вид, зависящий от состояния:

```
ИМЯ_ПОЛЬЗОВАТЕЛЯ@ИМЯ_ХОСТА:ТЕКУЩИЙ_КАТАЛОГ>
```

Корневой каталог в иерархии файловой системы -- это `/`. После входа
в систему, текущим является *домашний каталог* текущего пользователя, --
это каталог, который доступен как для чтения, так и для записи.

Домашние каталоги обычных пользователей располагаются в:
 * `/home/` -- для Linux
 * `/usr/local/home` -- для FreeBSD
 * `/Users` -- для MacOS

Независимо от используемой операционной системы, имя `~` (символ
"тильда", на одной клавише с буквой "Ё"), является синонимом домашнего
каталога *текущего пользователя*.

Лексемы `.` и `..` означают, соответственно, текущий каталог, и каталог
на один уровень выше в иерархии.

Для навигации по каталогам используется команда `cd`. Примеры:

```
cd ..          # Перейти на уровень выше
cd ../..       # Перейти на два уровня выше
cd ../src      # Перейти на уровень выше, затем в подкаталог src
cd /           # Перейти в корневой каталог
cd /usr/lib64  # Перейти в каталог /usr/lib64
cd ~/projects  # Перейти в каталог /home/ИМЯРЕК/projects
```

**Замечание**. При вводе имен файлов или каталогов, клавиша `TAB`
вызывает функцию автодополнения имени.

## Запуск выполняемых файлов

Выполняемый файл -- это любой файл (в том числе и текстовый), обладающий
специальным аттрибутом.

Запуск выполняемого файла осуществяется двумя способами:
 * Вводом имени этого файла в том случае, если файл располагается в одном
 из каталогов, перечисленных в *переменной окружения* `PATH`. Все стандартные
 программы, входящие в поставку UNIX-системы запускаются таким способом.
 * Вводом *полного имени* файла. Полное имя может быть как абсолютным (то есть
 начинаться с символа `/`), так и относительным (начиначется с символа `.`).
 Таким способом обычно запускаются программы, находящиеся в домашнем каталоге.


## Стандартные программы для управления файлами

 * `cp` -- копирование файла или каталога (с опцией `-R`)
 * `mv` -- переименование (перемещение) файла или каталога (с опцией `-R`)
 * `rm` -- удаление файла или каталога (с опцией `-r`)
 * `ls` -- вывод содержимого текущего каталога

Все эти команды являются обычными программами, которые располагаются в каталоге
`/usr/bin`.

**Вопрос**. Почему не существует программы с именем `cd`?
<!-- 
Правильный ответ: потому что текущий каталог -- это состояние интерпретатора.
Каждая команда запускается в отдельном процессе, который не может менять состояние процесса-родителя.
-->


## Форматы исполняемых файлов

 * Бинарный файл начинается с последовательности байт `0x7F 0x45 0x4C 0x46`.
 Этот формат называется ELF (Executable and Linkable Format).
 * Произвольный файл, в том числе текстовый, который начинается с текстовой
 строки вида `#!ИМЯ_ИНТЕРПРЕТАТОРА\n`. В этом случае, система запускает
 указанный интерпретатор, и передает ему выполняемый файл в качестве аргумента.

 Пример выполняемого файла:

 ```
 #!/usr/bin/python

 print("Hello, UNIX!")
 ```

# Midnight Commander

Для навигации по файловой системы, использование командной строки, -- это не всегда удобно.

**Замечание**. При использовании предоставляемого образа ВМ, файловая система также
доступна по FTP: [ftp://student@192.168.56.105/](ftp://student@192.168.56.105/).

*Midnight Commander* -- это двухпанельный файловый менеджер, доступный почти для всех
UNIX-подобных операционных систем (включая MacOS). Запускается командой `mc` и
работа с ним аналогична работе с FAR Manager или Total Commander. Исключение составляют некоторые клавиатурные сочетания. 

Основные операции:
 * `F3` -- просмотр файла
 * `F4` -- редактирование файла
 * `Shift+F4` -- создание и редактирование нового файла
 * `F5` -- копирование
 * `F6` -- перемещение
 * `F7` -- создание каталога
 * `F8` -- удаление
 * `F10` -- выход из Midnight Commander
 * `C-x c` -- редактирование аттрибутов файла
 * `C-x o` -- редактирование пользователя файла
 * `C-x s` -- создание символической ссылки на файл

**Замечание.** Выход из редактирования или просмотра файла осуществляется нажатием клавиши
`Esc` **два раза**. Это связано с тем, что клавиша `Esc` в классических терминалах предназначена
для префиксного ввода управляющих символов.


## Иерархия файловой системы

В отличии от Windows, где каждому физическому диску или разделу на диске соответствует определенная буква,
например `C:\`, дерево файловой системы в UNIX-системах имеет общий корень `/`. Отдельные диски или разделы
*монтируются* в подкаталоги основной файловой системы.

Файловая система всех дистрибутивов Linux имеет следующую иерархию:
 * `/bin` -- выполняемые программы, предоставляющие минимально необходимый набор команд
 * `/boot` -- файлы, необходимые для загрузки операционной системы
 * `/dev` -- псевдо-файлы устройств
 * `/etc` -- текстовые файлы настроек
 * `/home` -- домашние каталоги пользователей
 * `/lib` или `/lib64`, либо оба этих каталога -- минимально необходимый для работоспособности системы набор разделяемых библиотек. Каталог `/lib64` присутствует на 64-битных системах и содержит варианты библиотек для 
x86_64, в то время как `/lib` -- их аналоги для i386.
 * `/lost+found` -- файлы, которые по каким-либо причинам (например, неправильное выключение компьютера, или
сбой диска) оказались вне какого-либо каталога, но их содержимое доступно
 * `/media` -- каталог для монтирования сменных носителей, доступных всем пользователям
 * `/mnt` -- каталог для монтирования общедоступных сетевых файловых систем или инородных разделов
 * `/opt` -- каталог для установки сторонних приложений не из репозитория дистрибутива, например Google Chrome 
или Яндекс.Браузер
 * `/proc` -- здесь примонтирована виртуальная файловая система с информацией о запущенных в системе процессах
 * `/root` -- домашний каталог пользователя `root`
 * `/run` -- содержит *именованные сокеты* и текстовые файлы с *индентификаторами процесса* для запущенных демонов
 * `/sbin` -- выполняемые файлы для запуска пользователем `root`; у других пользователей этот каталог не включен
в переменную окружения `PATH`, и для их запуска необходимо указывать полный путь
 * `/srv` -- файлы для хранения данных сетевыми службами
 * `/sys` -- виртуальная файловая система для просмотра и изменения параметров ядра
 * `/tmp` -- каталог для временных файлов
 * `/usr` -- содержит иерархию, аналогичную корневой; там находятся файлы большинства программ, которые
устанавливаются из *репозиториев* дистрибутива
 * `/usr/local` -- аналогично `/usr`, но предназначен для установки программ самостоятельно из исходных текстов
 * `/var` -- содержит данные различных демонов, например базы данных.

# Консольные текстовые редакторы

## Встроенный редактор Midnight Commander

Вызывается нажатием клавиши `F4` из файлового менеджера, либо командой `mcedit ИМЯ_ФАЙЛА` как 
самостоятельная программа.

Основные клавиши:
 * `F2` -- сохранить файл
 * `Esc Esc` -- выход
 * `F3` -- начало/конец выделения текста
 * `F5` -- копирование выделенного текста в текущую позицию
 * `F6` -- перемещение выделенного текста в текущую позицию
 * `F8` -- удаление выделенного текста; если текст не выделен, -- удаление текущей строки

## Редактор VI

Поскольку Midnight Commander, и соответственно, редактор `mcedit` не всегда установлены по умолчанию,
иногда возникает необходимость использования редактора `vi`, который входит в базовый состав почти
всех дистрибутивов Linux.

Запускается редактор командой `vi ИМЯ_ФАЙЛА`, либо в результате какого-нибудь действия, которое требует
редактирования текста (например, командой `git commit` -- для редактирования комментария к коммиту).

Опознать редактор `vi` можно по черному экрану, в левом столбце терминала при этом во всех пустых строках
в конце текста присутствует символ `~`.

После запуска, редактор находится в **командном режиме**. Не нужно нажимать буквенно-цифровые клавиши для ввода текста в этом режиме. Если это все-же произошло, нужно нажать `C-[` для возврата в командный режим.

В командном режиме навигация по тексту осуществляется клавишами стрелок, а также клавишами `h`, `j`, `k`, и `l`.
Помимо текстового редактора `vi`, многие среды разработки, например QtCreator и IntelliJ IDEA, а также браузеры имеют Chrome и Firefox имеют плагины, позволяющие использовать навигацию в стиле VIM, так что назначение этих 
клавиш лучше запомнить.

Для перехода в **режим вставки**, привычному по GUI-редакторам, нужно нажать клавишу `i`. Выход из этого режима 
-- сочетанием `C-[`. Для перехода в **режим замены** -- клавиша `o`, выход аналогичен.

Основные команды, которые нужно запомнить:
 * `:w` -- сохранить файл
 * `:e ИМЯ_ФАЙЛА` -- открыть или создать файл с указанным именем
 * `:q` -- выход из редактора, возможен только если нет не сохраненных изменений
 * `:q!` -- принудительный выход из редактора без сохранения
 * `!КОМАНДА` -- запуск UNIX-команды без выхода из редактора

Более подробное руководство по `vi` можно получить, запустив программу `vimtutor`

## Редактор nano

В некоторых дистрибутивах, например Ubuntu, по умолчанию вместо `vi` установлен редактор `nano`.
Это простой в использовании текстовый редактор. Опознать его можно по тексту `GNU nano` в заголовке вверху 
терминала, и подсказкам о сочетаниях клавиш вида `^G Get Help` в подвале. Символ `^` означает клавишу `Ctrl`.

# Практическое задание

Создать простую программу на Python, которая выводит текст на экран. Сделать эту программу командой.
Запрещается использовать права `root`.

<!--
1. Написать программу, используя любой текстовый редактор
2. В образе ВМ каталог ~/bin добавлен в PATH. Нужно создать симлинк в этот каталог
3. Естественно, сделать файл выполняемым
-->


# Использование нескольких экземпляров командной строки

## Локальный консольный вход в систему

При использовании текстового терминала, можно использовать сочетания клавиш
от `Alt+F1` до `Alt+F6` для переключения между различными *консолями*.

Для каждой консоли необходимо выполнить отдельный вход в систему.

## С использованием tmux

В некоторых случаях возникает необходимость создания нескольких "окон",
используя при этом ровно один терминал. Для этих целей существует специальная
программа -- *оконный менеджер*.

Для создания нового сеанса оконного менеджера нужно набрать команду

```
tmux new
```

Если по каким-либо причинам (как правило, при использовании удаленного входа
в систему), соединение с UNIX-компьютером было разорвано, можно восстановить
существующий сеанс, **включая все запущенные программы** с помощью команды

```
tmux attach
```

Команды для tmux вводятся, начиная с *префикса* `C-b`:
 * `C-b c` -- создать новое окно
 * `C-b 0`..`C-b 9` -- переключиться на окно от 0 до 9
 * `C-b %` или `C-b "` (не забываем про клавишу `Shift`) -- разделить окно на две части
 по вертикали или по горизонтали
 * стрелки влево, вправо, вверх и вниз -- после разделения окна на части,
 перемещаться между ними.

Для того, чтобы полность завершить работу tmux, нужно завершить работу **всех**
программ, которые работают внутри сеанса. Для командной строки это делается
с помощью команды `exit`.


# Установка программ из репозиториев 

Большинство программ в Linux устанавливаются из *репозиториев*. Возможны и другие варианты установки,
например:
 * сборка из исходных текстов;
 * установка `.deb` или `.rpm` пакета вручную;
 * распаковка программы из архива, и ее копирование в `/opt`;
 * использование установщика в составе устанавливаемой программы.

Установка программ из репозиториев является **предпочтительным способом** установки.

Команды для установки зависят от конкретного дистрибутива.

## Обновление списка доступных пакетов
 * **Debian, AltLinux, Ubuntu**: `apt-get update`
 * **openSUSE**: `zypper ref`
 * **Fedora, CentOS**: выполяется при поиске или установке пакета

## Поиск пакета по фрагменту имени
 * **Debian, AltLinux, Ubuntu**: `apt-cache search ИМЯ`
 * **openSUSE**: `zypper search ИМЯ`
 * **Fedora, CentOS**: `yum search ИМЯ`
 
## Установка пакета по имени
 * **Debian, AltLinux, Ubuntu**: `apt-get install ИМЯ`
 * **openSUSE**: `zypper in ИМЯ`
 * **Fedora, CentOS**: `yum install ИМЯ`
 

